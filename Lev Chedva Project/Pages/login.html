<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../styles/LogIn_style.css">
    <title>Log In</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script src="../firebase.js"></script>
  </head>
  <body>
    <h1>כניסה</h1>
    <form id="login-form">
      <label for="email">:אימייל</label>
      <input type="email" id="email" name="email" required>
      <label for="password">:סיסמא</label>
      <input type="password" id="password" name="password" required>
      <button type="submit">היכנס</button>
    </form>

    <button id="google-login-btn" onclick="signInWithGoogle()">
      <img src="../Pics/icons8-google-48.png" alt="Google logo">
      
    </button>
    
    <script>
      // Get references to the email and password input fields
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      
      // Get a reference to the login form
      const loginForm = document.getElementById("login-form");
      
      // Add an event listener to the login form
      loginForm.addEventListener("submit", (event) => {
        event.preventDefault();
        
        // Get the email and password values from the form
        const email = emailInput.value;
        const password = passwordInput.value;
        
        // Log in the user using Firebase Authentication
        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)
  .then(() => {
    return firebase.auth().signInWithEmailAndPassword(email, password);
  })
  .then((userCredential) => {
    // Logged in successfully
    const user = userCredential.user;
    console.log(user);
    console.log("Logged in");
    checkAuthorizationAndRedirect(email);
  })
  .catch((error) => {
    // Handle login errors
    const errorCode = error.code;
    const errorMessage = error.message;
    console.error(errorCode, errorMessage);
  });
      });

      function signInWithGoogle() {
  var provider = new firebase.auth.GoogleAuthProvider();
  firebase.auth().signInWithPopup(provider)
    .then((result) => {
      console.log("Log In");
    })
    .catch((error) => {
      // Handle errors here
      var errorCode = error.code;
      var errorMessage = error.message;
      console.log(errorCode + ': ' + errorMessage);
    });
}


function checkAuthorizationAndRedirect(email) {
  
  // Get the document from the "Volunteers" collection based on the provided email
  firebase.firestore().collection("Volunteers").doc(email).get().then((doc) => {
    
    if (doc.exists) {
      // If the document exists, get the "Authorizations" field
      const authorizations = doc.data().Authorizations;
      
      if (authorizations == "0") {
        // If the "Authorizations" field is 0, redirect to page A
        window.location.href = "../Pages/Manager_Panel.html";
      } else {
        // If the "Authorizations" field is not 0, redirect to page B
        window.location.href = "../Pages/Volunteer_Dashboard.html";
      }
    } else {
      // If the document doesn't exist, log an error and redirect to an error page
      console.error("No such document!");
      window.location.href = "error.html";
    }
  }).catch((error) => {
    // Handle errors
    console.error("Error getting document:", error);
    window.location.href = "error.html";
  });
}





    </script>
  </body>
</html>
